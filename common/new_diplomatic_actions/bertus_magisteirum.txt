
magisterium_invite_organization_action = {
	category = mages_influence_modifier
	require_acceptance = yes
	alert_index = 21
	
	is_visible = {
		tag = A85
		FROM = { NOT = {has_estate_privilege = estate_mages_organization_magisterium }}
    }
	
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = not_war_with_root_tt
			FROM = { NOT = {war_with = ROOT}}
		}
		custom_trigger_tooltip = {
			tooltip = from_has_100_opinion_tt
			FROM = { has_opinion = {who = ROOT value = 100}}
		}
	}

    on_accept = {
		FROM = {			
			if = {limit = {has_estate_privilege = estate_mages_organization_state} remove_estate_privilege = estate_mages_organization_state}
			if = {limit = {has_estate_privilege = estate_mages_organization_guilds} remove_estate_privilege = estate_mages_organization_guilds}
			if = {limit = {has_estate_privilege = estate_mages_organization_religious} remove_estate_privilege = estate_mages_organization_religious}
			if = {limit = {has_estate_privilege = estate_mages_organization_covenant} remove_estate_privilege = estate_mages_organization_covenant}
			if = {limit = {has_estate_privilege = estate_mages_organization_elissa} remove_estate_privilege = estate_mages_organization_elissa}
			if = {limit = {has_estate_privilege = estate_mages_organization_bardic_college} remove_estate_privilege = estate_mages_organization_bardic_college}
			if = {limit = {has_estate_privilege = estate_mages_organization_ice_smiths} remove_estate_privilege = estate_mages_organization_ice_smiths}
			set_estate_privilege = estate_mages_organization_magisterium
			add_stability = -2
		}
	}
	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = THIS
			}
			divide_variable = { which = ai_value value = 4 }
		}
	}
	ai_will_do = {always = no}
}

magisterium_study_assistance_action = {
	category = mages_influence_modifier
	require_acceptance = yes
	alert_index = 21
	
	is_visible = {
		tag = A85
		FROM = { has_estate_privilege = estate_mages_organization_magisterium }
		FROM = {NOT = { has_ruler_flag = magisterium_study_assistance_flag}}
    }
	
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = from_is_studying_magic_tt
			FROM = { ruler_studying_magic = yes }
		}
		custom_trigger_tooltip = {
			tooltip = from_has_100_opinion_tt
			FROM = { has_opinion = {who = ROOT value = 100}}
		}
		custom_trigger_tooltip = {
			tooltip = not_war_with_root_tt
			FROM = { NOT = {war_with = ROOT}}
		}
	}

    on_accept = {
		FROM = {
			set_ruler_flag = magisterium_study_assistance_flag 
			country_event = {id = bertus_changes.1118}
		}
	}
	ai_acceptance = {always = yes}
	ai_will_do = {always = no}
}
cancel_magisterium_study_assistance_action = {
	category = mages_influence_modifier
	alert_index = 21
	
	require_acceptance = no
	
	is_visible = {
		FROM = { has_ruler_flag = magisterium_study_assistance_flag }
    }
	
	is_allowed = {
		hidden_trigger = { FROM = { has_ruler_flag = magisterium_study_assistance_flag } }
	}

    on_accept = {
		FROM = {
			clr_ruler_flag = magisterium_study_assistance_flag 
			country_event = {id = bertus_changes.1118}
		}
	}
	
	ai_will_do = {always = no}
}
magister_sphere_denounce_action = {
	category = mages_influence_modifier
	alert_index = 21
	
	require_acceptance = no
	
	is_visible = {
		FROM = {
			has_estate_privilege = estate_mages_organization_magisterium
			has_ruler_flag = caught_studying_banned_magic_flag 
			NOT = {has_ruler_flag = magister_denounced_flag }
		}
    }
	
	is_allowed = {
		hidden_trigger = { FROM = { has_ruler_flag = caught_studying_banned_magic_flag } }
	}

    on_accept = {
		FROM = { 
			set_ruler_flag = magister_denounced_flag 
			country_event = {id = bertus_changes.1117}
		}
	}
	
	ai_will_do = {always = no}
}

magisterium_investigate_action = {
	category = mages_influence_modifier
	require_acceptance = no
	alert_index = 21
	
	is_visible = {
		FROM = {
			has_estate_privilege = estate_mages_organization_magisterium
		}
		FROM = {NOT = {has_ruler_flag = magisterium_investigating_flag_@ROOT}}
    }
	
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = need_75_spy_network_tt
			has_spy_network_in = {who = FROM value = 75}
		}
		custom_trigger_tooltip = {
			tooltip = magisterium_can_investigate_tt
			FROM = { magisterium_can_investigate = yes}
		}
	}

    on_accept = {
		set_country_flag = magisterium_investigating_flag_@FROM
		FROM = {
			set_ruler_flag = magisterium_investigating_flag_@ROOT
			country_event = {
				id = bertus_changes.1115
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -75
		}
		
	}
	ai_will_do = {always = no}
}
cancel_magisterium_investigate_action = {
	category = mages_influence_modifier
	require_acceptance = yes
	alert_index = 21
	
	is_visible = {
		FROM = { has_ruler_flag = magisterium_investigating_flag_@ROOT }
    }
	
	is_allowed = {
		hidden_trigger = { FROM = { has_ruler_flag = magisterium_investigating_flag_@ROOT } }
	}

    on_accept = {
		FROM = { clr_ruler_flag = magisterium_investigating_flag_@ROOT }
		clr_country_flag = magisterium_investigating_flag_@FROM
	}
	
	ai_will_do = {always = no}
}
magisterium_get_mage_general_action = {
	category = mages_influence_modifier
	require_acceptance = yes
	alert_index = 21
	
	is_visible = {
		tag = A85
		FROM = {
			has_estate_privilege = estate_mages_organization_magisterium 
		}
    }
	
	is_allowed = {
		estate_loyalty = {
			estate = estate_mages
			loyalty = 60
		}
		custom_trigger_tooltip = {
			tooltip = not_war_with_root_tt
			FROM = { NOT = {war_with = ROOT}}
		}
	}

    on_accept = {
		ROOT = {
			add_estate_loyalty = {
				estate = estate_mages
				loyalty = -20
			}
		}
		FROM = {
			set_country_flag = get_mage_flag
			set_country_flag = magisterium_free_general_flag
			country_event = {id = bertus_changes.6010}
		}
	}
	ai_will_do = {always = no}
}
magisterium_get_mage_advisor_action = {
	category = mages_influence_modifier
	require_acceptance = yes
	alert_index = 21
	
	is_visible = {
		tag = A85
		FROM = {
			has_estate_privilege = estate_mages_organization_magisterium 
		}
    }
	
	is_allowed = {
		estate_loyalty = {
			estate = estate_mages
			loyalty = 60
		}
		custom_trigger_tooltip = {
			tooltip = not_war_with_root_tt
			FROM = { NOT = {war_with = ROOT}}
		}
	}

    on_accept = {
		ROOT = {
			add_estate_loyalty = {
				estate = estate_mages
				loyalty = -20
			}
		}
		FROM = {
			define_advisor = {
				type = mage
				skill = 2
				culture = ROOT
				religion = ROOT
				cost_multiplier = 0.5
			}
		}
	}
	ai_will_do = {always = no}
}
magisterium_organize_magical_council_action = {
	category = mages_influence_modifier
	require_acceptance = yes
	alert_index = 21
	
	is_visible = {
		tag = A85
		FROM = {
			has_estate_privilege = estate_mages_organization_magisterium 
		}
    }
	
	is_allowed = {
		NOT = {
			any_province = {
				has_province_modifier = magical_council_modifier
			}
		}
		custom_trigger_tooltip = {
			tooltip = not_war_with_root_tt
			FROM = { NOT = {war_with = ROOT}}
		}
		custom_trigger_tooltip = {
			tooltip = from_has_100_opinion_tt
			FROM = { has_opinion = {who = ROOT value = 100}}
		}
	}

    on_accept = {
		ROOT = {
			add_estate_loyalty = {
				estate = estate_mages
				loyalty = -20
			}
		}
		FROM = {
			capital_scope = {
				add_province_modifier = {
					name = magical_council_modifier
					duration = 3650
				}
			}
		}
	}
	ai_will_do = {always = no}
}