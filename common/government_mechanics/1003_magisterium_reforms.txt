magisterium_mechanic = {
	alert_icon_gfx = GFX_alerticons_government_mechanics
	alert_icon_index = 19
	available = {
		has_dlc = "Rights of Man"
		NOT = { has_reform = hobgoblin_stratocracy_reform }
		NOT = { has_country_flag = banned_magic }
		NOT = { has_estate = estate_acolytes }
		NOT = { AND = { religion = bulwari_sun_cult has_country_flag = nsc_human_country_magic_prohibition } }
		NOT = { has_reform = tagharoghi_reform }
		NOT = { has_reform = demon_empire_reform }
	}

	powers = {
		magisterium_mana = {
			gui = magisterium_gov_mech
			is_good = yes
			max = 100
			base_monthly_growth = 0.4166
			#scaled_modifier = {
			#	modifier = {
			#		all_power_cost = -0.10
			#	}
			#}
			on_max_reached = {
				hidden_effect = {
					if = {
						limit = {has_country_flag = contribute_mana_flag}
						add_government_power = { 
							mechanic_type = magisterium_mechanic 
							power_type = magisterium_mana
							value = -1
						}
						add_estate_loyalty = {
							estate = estate_mages
							loyalty = 0.5
						}
						A85 = {
							add_government_power = { 
								mechanic_type = magisterium_mechanic 
								power_type = magisterium_mana
								value = 0.5
							}
						}
					}
				}
			}
		}
	}
	
	interactions = {
		contribute_mana = {
			icon = GFX_magic_schools_of_magic
			gui = magisterium_gov_mech_interaction
			cost_type = magisterium_mana
			trigger = {
				NOT = {tag = A85}
				if = {
					limit = {has_estate_influence_modifier = { estate = estate_mages modifier = EST_VAL_GAVE_MANA_influence} }
					custom_trigger_tooltip = {
						tooltip = EST_VAL_GAVE_MANA_TT
						NOT = {has_estate_influence_modifier = { estate = estate_mages modifier = EST_VAL_GAVE_MANA_influence } }
						NOT = {has_estate_loyalty_modifier = { estate = estate_mages modifier = EST_VAL_GAVE_MANA_loyalty } }
					}
				}
				if = {
					limit = {
						NOT = {has_estate_privilege = estate_mages_organization_magisterium}
					}
					has_government_power = { 
						mechanic_type = magisterium_mechanic 
						power_type = magisterium_mana
						value = 33
					}
				}
			}
			effect = {
				if = {
					limit = {has_estate_privilege = estate_mages_organization_magisterium}
					if = {
						limit = {NOT = {has_country_flag = contribute_mana_flag}}
						custom_tooltip = activate_contribute_magisterium_mana_tt
						set_country_flag = contribute_mana_flag
					}
					else = {
						clr_country_flag = contribute_mana_flag
						custom_tooltip = deactivate_contribute_magisterium_mana_tt
					}
				}
				else = {
					custom_tooltip = activate_contribute_mana_tt
					add_government_power = {
						mechanic_type = magisterium_mechanic 
						power_type = magisterium_mana
						value = -33
					}
					add_estate_influence_modifier = {
						estate = estate_mages
						desc = EST_VAL_GAVE_MANA_influence
						influence = 10
						duration = 7300
					}
					add_estate_loyalty_modifier = {
						estate = estate_mages
						desc = EST_VAL_GAVE_MANA_loyalty
						loyalty = 10
						duration = 7300
					}
				}
			}
			cooldown_years = 0
			ai_chance = {factor = 0}
		}
		schools_of_magic = {
			icon = GFX_magic_schools_of_magic
			gui = magisterium_gov_mech_interaction
			cost_type = magisterium_mana
			trigger = {
				if = {
					limit = {
						OR = {
							NOT = {has_estate_privilege = estate_mages_organization_magisterium}
							tag = A85
						}
					}
					custom_trigger_tooltip = {
						tooltip = "Magisters Menu Closed"
						NOT = {has_country_flag = magisters_mechanic_menu_flag}
					}
				}
				else = {
					custom_trigger_tooltip = {
						tooltip = "You are not the High Magister"
						always = no
					}
				}
				if = {
					limit = { ai = yes }
					has_government_power = { 
						mechanic_type = magisterium_mechanic
						power_type = magisterium_mana
						value = 75
					}
				}
			}
			effect = {
				if = {
					limit = {
						tag = A85
					}
					set_country_flag = magisters_mechanic_menu_flag
					country_event = {id = bertus_changes.6035}
				}
				else_if = {
					limit = {
						NOT = {has_estate_privilege = estate_mages_organization_magisterium}
					}
					set_country_flag = magisters_mechanic_menu_flag
					country_event = {id = bertus_changes.6040}
				}
				else = {
				}
			}
			cooldown_years = 0
			ai_chance = {
				factor = 1
				modifier = {
					factor = 0
					NOT = { tag = A85 }
				}
			}
		}
	}
}