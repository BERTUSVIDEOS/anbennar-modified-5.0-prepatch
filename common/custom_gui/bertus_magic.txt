

custom_button = {
    name = magic_menu_ruler
    potential = {
		ruler_has_mage_personality = yes
	}
	trigger = {
		hidden_trigger = {
			ai = no	#bertus mod
			NOT = { has_ruler_flag = magic_menu_opened }
		}
		if = {
			limit = { has_country_flag = in_magocracy_heir_selection }
			NOT = { has_country_flag = in_magocracy_heir_selection }
		}
		if = {
			limit = { has_country_flag = in_magocracy_magister_selection }
			NOT = { has_country_flag = in_magocracy_magister_selection }
		}
		if = {
			limit = { has_ruler_modifier = magic_realm_menu_cooldown }
			NOT = { has_ruler_modifier = magic_realm_menu_cooldown }
		}
		if = { limit = { NOT = {months_of_ruling = 2 }}
			months_of_ruling = 2
		}
		if = { limit = { is_lesser_in_union = yes }
			is_lesser_in_union = no
		}
		if = { limit = { has_ruler_flag = abjuration_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_abjuration_3 }
		}
		else_if = { limit = { has_ruler_flag = abjuration_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_abjuration_2 }
		}
		else_if = { limit = { has_ruler_flag = abjuration_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_abjuration_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_abjuration_0 }
		}
		if = { limit = { has_ruler_flag = conjuration_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_conjuration_3 }
		}
		else_if = { limit = { has_ruler_flag = conjuration_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_conjuration_2 }
		}
		else_if = { limit = { has_ruler_flag = conjuration_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_conjuration_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_conjuration_0 }
		}
		if = { limit = { has_ruler_flag = divination_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_divination_3 }
		}
		else_if = { limit = { has_ruler_flag = divination_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_divination_2 }
		}
		else_if = { limit = { has_ruler_flag = divination_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_divination_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_divination_0 }
		}
		if = { limit = { has_ruler_flag = enchantment_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_enchantment_3 }
		}
		else_if = { limit = { has_ruler_flag = enchantment_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_enchantment_2 }
		}
		else_if = { limit = { has_ruler_flag = enchantment_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_enchantment_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_enchantment_0 }
		}
		if = { limit = { has_ruler_flag = evocation_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_evocation_3 }
		}
		else_if = { limit = { has_ruler_flag = evocation_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_evocation_2 }
		}
		else_if = { limit = { has_ruler_flag = evocation_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_evocation_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_evocation_0 }
		}
		if = { limit = { has_ruler_flag = illusion_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_illusion_3 }
		}
		else_if = { limit = { has_ruler_flag = illusion_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_illusion_2 }
		}
		else_if = { limit = { has_ruler_flag = illusion_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_illusion_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_illusion_0 }
		}
		if = { limit = { has_ruler_flag = necromancy_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_necromancy_3 }
		}
		else_if = { limit = { has_ruler_flag = necromancy_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_necromancy_2 }
		}
		else_if = { limit = { has_ruler_flag = necromancy_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_necromancy_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_necromancy_0 }
		}
		if = { limit = { has_ruler_flag = transmutation_3 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_transmutation_3 }
		}
		else_if = { limit = { has_ruler_flag = transmutation_2 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_transmutation_2 }
		}
		else_if = { limit = { has_ruler_flag = transmutation_1 }
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_transmutation_1 }
		}
		else = {
			custom_trigger_tooltip = { always = yes tooltip = tooltip_has_transmutation_0 }
		}
	}
	effect = {
		hidden_effect = { country_event = { id = magic_ruler.0 } }
		open_single_menu = yes
		#Allows for vampires that become mages naturally
		hidden_effect = {
			if = { 
				limit = { has_ruler_flag = is_a_vampire }
				set_country_flag = mage_vampire
			}
		}
	}
	tooltip = open_ruler_magic_menu_tt
}
custom_button = {
    name = siege_magic
    potential = {
		ai = no
		ruler_has_mage_personality = yes
		months_of_ruling = 2
		NOT = { has_ruler_flag = magic_menu_opened }
	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = ruler_knows_siege_spell_tt
			OR = {
				has_ruler_flag = conjuration_1
				has_ruler_flag = evocation_1
				has_ruler_flag = transmutation_2
				has_ruler_flag = enchantment_3
			}
		}
		is_at_war = yes
		NOT = { has_ruler_modifier = magic_siege_cooldown }
		is_lesser_in_union = no
		any_army = {
			location = {
				fort_level = 1
				sieged_by = ROOT
				unit_has_leader = yes
				has_ruler_leader_from = ROOT
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
		}
		hidden_trigger = {
			NOT = { has_ruler_flag = magic_menu_opened }
		}
	}
	effect = {
		set_ruler_flag = magic_siege_menu
		custom_tooltip = open_siege_magic_menu_tt
		hidden_effect = { country_event = { id = magic_siege.1 } }
		open_single_menu = yes
	}
    tooltip = siege_magic_tt
}
custom_button = {
    name = magic_menu_estate
    
    potential = {
		ai = no
		has_estate = estate_mages
		NOT = { has_country_flag = Y63_unlocked_minor_runes }
		#if = { limit = { tag = I02 }	#krak
		#	mission_completed = krak_relighting_forges
		#}
		NOT = { has_estate = estate_acolytes }
		NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
	}
	trigger = {}
	effect = {
		hidden_effect = {
			if = { limit = { NOT = { has_country_flag = estate_mages_cast_spells } } set_country_flag = estate_mages_cast_spells }
			else = { clr_country_flag = estate_mages_cast_spells }
			clr_country_flag = estate_mages_cast_spell_divination
			clr_country_flag = estate_mages_cast_spell_enchantment
			clr_country_flag = estate_mages_cast_spell_abjuration
			clr_country_flag = estate_mages_cast_spell_transmutation
			clr_country_flag = estate_mages_cast_spell_evocation
			clr_country_flag = estate_mages_cast_spell_illusion
			clr_country_flag = estate_mages_cast_spell_necromancy
			clr_country_flag = estate_mages_cast_spell_conjuration
		}
	}
	tooltip = "Cast Spell"
}
custom_window = {
	name = magic_magisterium_sphere_window
	
    potential = {
		has_estate_privilege = estate_mages_organization_magisterium
	}
}
custom_shield = {
    name = magic_magisterium_sphere
    potential = { has_estate_privilege = estate_mages_organization_magisterium }
    trigger = { }
    effect = {
		custom_tooltip = magic_magisterium_sphere_desc
		every_country = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			custom_tooltip = ""
		}
		hidden_effect = {
			A85 = {
				set_variable = { which = magisterium_sphere_members_value value = 0 }
				every_country = {
					limit = { has_estate_privilege = estate_mages_organization_magisterium }
					change_variable = { which = magisterium_sphere_members_value value = 1 }
				}
			}
		}
	}
	tooltip = "Magisterium Sphere"
    global_event_target = magisterium
    open_country = yes
}
custom_button = {
	name = schools_mana_contribution
    potential = {
		has_country_flag = estate_mages_cast_spells
		NOT = { tag = A85 } 
	}
	trigger = {
		if = {
			limit = {has_estate_influence_modifier = { estate = estate_mages modifier = EST_VAL_GAVE_MANA_influence} }
			custom_trigger_tooltip = {
				tooltip = EST_VAL_GAVE_MANA_TT
				NOT = {has_estate_influence_modifier = { estate = estate_mages modifier = EST_VAL_GAVE_MANA_influence } }
				NOT = {has_estate_loyalty_modifier = { estate = estate_mages modifier = EST_VAL_GAVE_MANA_loyalty } }
			}
		}
		if = {
			limit = { NOT = { has_estate_privilege = estate_mages_organization_magisterium } }
			has_mana = { mana = 33 no_spell_in_a_box = yes }
		}
	}
	effect = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			if = {
				limit = { NOT = { has_country_flag = contribute_mana_flag } }
				custom_tooltip = activate_contribute_magisterium_mana_tt
				set_country_flag = contribute_mana_flag
			}
			else = {
				clr_country_flag = contribute_mana_flag
				custom_tooltip = deactivate_contribute_magisterium_mana_tt
			}
		}
		else = {
			custom_tooltip = activate_contribute_mana_tt
			add_mana_effect = { mana = -33 no_spell_in_a_box = yes }
			add_estate_influence_modifier = { estate = estate_mages desc = EST_VAL_GAVE_MANA_influence influence = 10 duration = 7300 }
			add_estate_loyalty_modifier = { estate = estate_mages desc = EST_VAL_GAVE_MANA_loyalty loyalty = 10 duration = 7300 }
		}
	}
	tooltip = "Mana Contribution"
}
custom_button = {
	name = schools_of_magic
    potential = {
		has_country_flag = estate_mages_cast_spells
		tag = A85
	}
	trigger = {
		custom_trigger_tooltip = {
			tooltip = "Magisters Menu Closed"
			NOT = {has_country_flag = magisters_mechanic_menu_flag}
		}
		if = {
			limit = { ai = yes }
			has_mana = { mana = 75 no_spell_in_a_box = yes }
		}
	}
	effect = {
		set_country_flag = magisters_mechanic_menu_flag
		country_event = { id = bertus_changes.6037 }
	}
	tooltip = "Encat Magisterium Decree"
}
custom_icon = {
	name = topbar_mana_overlay
	
    potential = {
		ai = no	
	}
	tooltip = ""
}
custom_text_box = {
	name = magic_menu_topbar_mana_overlay_value
	
    potential = {
		ai = no	
	}
	tooltip = magic_menu_topbar_mana_overlay_value_tt
}
custom_window = {
	name = magic_menu_window
	
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
}
custom_icon = {
	name = magic_menu_background
	
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_icon = {
	name = magic_menu_mana_frame
	
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_icon = {
	name = magic_menu_mana
	
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = magic_menu_mana_tt
	frame = { number = 20 trigger = { has_mana = { mana = 100 } } }
	frame = { number = 19 trigger = { has_mana = { mana = 95 } } }
	frame = { number = 18 trigger = { has_mana = { mana = 90 } } }
	frame = { number = 17 trigger = { has_mana = { mana = 85 } } }
	frame = { number = 16 trigger = { has_mana = { mana = 80 } } }
	frame = { number = 15 trigger = { has_mana = { mana = 75 } } }
	frame = { number = 14 trigger = { has_mana = { mana = 70 } } }
	frame = { number = 13 trigger = { has_mana = { mana = 65 } } }
	frame = { number = 12 trigger = { has_mana = { mana = 60 } } }
	frame = { number = 11 trigger = { has_mana = { mana = 55 } } }
	frame = { number = 10 trigger = { has_mana = { mana = 50 } } }
	frame = { number = 9 trigger = { has_mana = { mana = 45 } } }
	frame = { number = 8 trigger = { has_mana = { mana = 40 } } }
	frame = { number = 7 trigger = { has_mana = { mana = 35 } } }
	frame = { number = 6 trigger = { has_mana = { mana = 30 } } }
	frame = { number = 5 trigger = { has_mana = { mana = 25 } } }
	frame = { number = 4 trigger = { has_mana = { mana = 20 } } }
	frame = { number = 3 trigger = { has_mana = { mana = 15 } } }
	frame = { number = 2 trigger = { has_mana = { mana = 10 } } }
	frame = { number = 1 trigger = { has_mana = { mana = 5 	} } }
	frame = { number = 21 trigger = { } }
}
custom_icon = {
	name = magic_menu_spell_strength
	
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_text_box = {
	name = magic_menu_spell_strength_text
	
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_button = {
	name = divination_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { has_country_flag = estate_mages_cast_spell_divination }
			clr_country_flag = estate_mages_cast_spell_divination
		}
		else = {
			set_country_flag = estate_mages_cast_spell_divination
			clr_country_flag = estate_mages_cast_spell_enchantment
			clr_country_flag = estate_mages_cast_spell_abjuration
			clr_country_flag = estate_mages_cast_spell_transmutation
			clr_country_flag = estate_mages_cast_spell_evocation
			clr_country_flag = estate_mages_cast_spell_illusion
			clr_country_flag = estate_mages_cast_spell_necromancy
			clr_country_flag = estate_mages_cast_spell_conjuration
		}
	}
	tooltip = "Divination School"
}
custom_window = {
	name = magic_menu_divination_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_divination
	}
}
custom_icon = {
	name = divination_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_divination
	}
	tooltip = divination_school_spells_tt
}
custom_button = {
	name = upgrade_icon_divination
	potential = {
		has_country_flag = estate_mages_cast_spell_divination
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = divination level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = divination }
	}
	tooltip = "Upgrade Divination"
}
custom_icon = {
	name = divination_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = divination level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = divination level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = divination level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_scrying_rivals
    
    potential = {
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = divination level = 1 } } }
			has_unlocked_magic_school = { school = divination level = 1 }
		}
		any_rival_country  = { exists = yes }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_1}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_2}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_3}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_3}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_1}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_2}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_3}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_3}
		}
		has_mana = { mana = 10 }
	}
	effect = {
		if = { 
			limit = {
				has_unlocked_magic_school = { school = divination level = 3 }
				has_mana = { mana = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_rivals_3 duration = 3650 }
			every_rival_country = {
				remove_fow = 4
				add_spy_network_from = { who = ROOT value = 30 }
				add_spy_network_in = { who = ROOT value = -30 } 
			}
		}
		else_if = { 
			limit = {
				has_unlocked_magic_school = { school = divination level = 2 }
				has_mana = { mana = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_scrying_rivals_2 duration = 3650 }
			every_rival_country = {
				remove_fow = 3
				add_spy_network_from = { who = ROOT value = 20 }
				add_spy_network_in = { who = ROOT value = -20 }
			}
			if = {
				limit = { has_unlocked_magic_school = { school = divination level = 3 } }
				custom_tooltip = magisters_need_30_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_enchantment_tt
			}
		}
		else = {
			add_mana_effect = { mana = -10 }
			add_country_modifier = { name = magic_estate_scrying_rivals_1 duration = 3650 }
			every_rival_country = {
				remove_fow = 2
				add_spy_network_from = { who = ROOT value = 10 }
				add_spy_network_in = { who = ROOT value = -10 }
			}
			if = {
				limit = { has_unlocked_magic_school = { school = divination level = 2 } }
				custom_tooltip = magisters_need_20_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_enchantment_tt
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_divination
		}
	}
	tooltip = "Scrying Rivals"
}
custom_button = {
    name = magic_menu_scrying_neighbours
    
    potential = {
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = divination level = 1 } } }
			has_unlocked_magic_school = { school = divination level = 1 }
		}
		any_country = { is_neighbor_of = ROOT }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_1}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_2}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_3}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_3}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_1}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_2}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_3}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_3}
		}
		has_mana = { mana = 10 }
	}
	effect = {
		hidden_effect = {
			every_country = { 
				limit = { is_neighbor_of = ROOT }
				country_event = {id = bertus_changes.1113}
			}
		}	
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = divination level = 3 }
				has_mana = { mana = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_neighbours_3 duration = 3650 }
			custom_tooltip = magic_scrying_fow_3_tt
			hidden_effect = { every_neighbor_country = { remove_fow = 4 } }
			if = { limit = { neighbor_is_ahead_in_institution = yes }
				capital_scope = {
					area = {
						limit = { owned_by = ROOT }
						add_province_modifier = { name = magic_estate_scrying_stealing_institution_3 duration = 3650 }
					}
				}
			}
		}
		else_if = { 
			limit = { 
				has_unlocked_magic_school = { school = divination level = 2 }
				has_mana = { mana = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_scrying_neighbours_2 duration = 3650 }
			custom_tooltip = magic_scrying_fow_2_tt
			hidden_effect = { every_neighbor_country = { remove_fow = 3 } }
			if = { limit = { neighbor_is_ahead_in_institution = yes }
				capital_scope = {
					area = {
						limit = { owned_by = ROOT }
						add_province_modifier = { name = magic_estate_scrying_stealing_institution_2 duration = 3650 }
					}
				}
			}
			if = {
				limit = { has_unlocked_magic_school = { school = divination level = 3 } }
				custom_tooltip = magisters_need_30_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_enchantment_tt
			}
		}
		else = {
			add_mana_effect = { mana = -10 }
			add_country_modifier = { name = magic_estate_scrying_neighbours_1 duration = 3650 }
			custom_tooltip = magic_scrying_fow_1_tt
			hidden_effect = { every_neighbor_country = { remove_fow = 2 } }
			if = { limit = { neighbor_is_ahead_in_institution = yes }
				capital_scope = {
					area = {
						limit = { owned_by = ROOT }
						add_province_modifier = { name = magic_estate_scrying_stealing_institution_1 duration = 3650 }
					}
				}
			}
			if = {
				limit = { has_unlocked_magic_school = { school = divination level = 2 } }
				custom_tooltip = magisters_need_20_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_enchantment_tt
			}
		}
		
		custom_tooltip = magic_scrying_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_divination
		}
	}
	tooltip = "Scrying Neighbours"
}
custom_button = {
    name = magic_menu_scrying_internal_dissidents
    
    potential = {
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = divination level = 1 } } }
			has_unlocked_magic_school = { school = divination level = 1 }
		}
		has_mana = { mana = 20 }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_internal_dissidents_1}
			NOT = {has_country_modifier = magic_estate_scrying_internal_dissidents_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_internal_dissidents_2}
			NOT = {has_country_modifier = magic_estate_scrying_internal_dissidents_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_internal_dissidents_3}
			NOT = {has_country_modifier = magic_estate_scrying_internal_dissidents_3}
		}
	}
	effect = {
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = divination level = 3 } 
				has_mana = { mana = 40 }
			}
			add_mana_effect = { mana = -40 }
			add_country_modifier = { name = magic_estate_scrying_internal_dissidents_3 duration = 3650 }
		}
		else_if = { 
			limit = { 
				has_unlocked_magic_school = { school = divination level = 2 } 
				has_mana = { mana = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_internal_dissidents_2 duration = 3650 }
			if = {
				limit = { has_unlocked_magic_school = { school = divination level = 3 } }
				custom_tooltip = magisters_need_40_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_divination_tt
			}
		}
		else_if = {
			limit = {
				has_mana = { mana = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_scrying_internal_dissidents_1 duration = 3650 }
			if = {
				limit = { has_unlocked_magic_school = { school = divination level = 2 } }
				custom_tooltip = magisters_need_30_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_2_divination_tt
			}
		}
		custom_tooltip = magic_scrying_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_divination
		}
	}
	tooltip = "Scrying Internal Dissidents"
}
custom_button = {
    name = magic_menu_foretelling
    
    potential = {
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = divination level = 1 } } }
			has_unlocked_magic_school = { school = divination level = 1 }
		}
		has_mana = { mana = 25 }
		if = {
			limit = {has_country_modifier = divination_foretelling_1_school_modifier }
			NOT = {has_country_modifier = divination_foretelling_1_school_modifier }
		}
		if = {
			limit = {has_country_modifier = divination_foretelling_2_school_modifier }
			NOT = {has_country_modifier = divination_foretelling_2_school_modifier }
		}
	}
	effect = {
		if = {
			limit = { has_unlocked_magic_school = { school = divination level = 2 } has_mana = { mana = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = divination_foretelling_2_school_modifier duration = 365 }
		}
		else = {
			add_mana_effect = { mana = -25 }
			add_country_modifier = { name = divination_foretelling_1_school_modifier duration = 365 }
			custom_tooltip = magisters_need_50_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_divination
		}
	}
	tooltip = "Foretelling"
}
custom_button = {
	name = enchantment_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_enchantment }
				clr_country_flag = estate_mages_cast_spell_enchantment
			}
			else = {
				set_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Enchantment School"
}
custom_window = {
	name = magic_menu_enchantment_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
	}
}
custom_icon = {
	name = enchantment_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	tooltip = enchantment_school_spells_tt
}
custom_button = {
	name = upgrade_icon_enchantment
	potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = enchantment level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = enchantment }
	}
	tooltip = "Upgrade Enchantment"
}
custom_icon = {
	name = enchantment_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = enchantment level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = enchantment level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = enchantment level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_aid_war_effort
    
    potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = enchantment level = 1 } } }
			has_unlocked_magic_school = { school = enchantment level = 1 }
		}
		is_at_war = yes
		has_mana = { mana = 30 }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_military_intelligence_1}
			NOT = {has_country_modifier = magic_estate_scrying_military_intelligence_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_military_intelligence_2}
			NOT = {has_country_modifier = magic_estate_scrying_military_intelligence_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_military_intelligence_3}
			NOT = {has_country_modifier = magic_estate_scrying_military_intelligence_3}
		}
	}
	effect = {
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = enchantment level = 3 }
				has_mana = { mana = 90 }
			}
			add_mana_effect = { mana = -90 }
			add_country_modifier = { name = magic_estate_scrying_military_intelligence_3 duration = 1825 }
			every_country = {
				limit = { war_with = ROOT }
				remove_fow = 4
			}
		}
		else_if = { 
			limit = { 
				OR = { has_unlocked_magic_school = { school = enchantment level = 2 } has_country_flag = command_enslaved_the_oracle_flag } 
				has_mana = { mana = 60 }
			}
			add_mana_effect = { mana = -60 }
			add_country_modifier = { name = magic_estate_scrying_military_intelligence_2 duration = 1825 }
			every_country = {
				limit = { war_with = ROOT }
				remove_fow = 3
			}
			if = {
				limit = { has_unlocked_magic_school = { school = enchantment level = 3 } }
				custom_tooltip = magisters_need_90_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_enchantment_tt
			}
		}
		else = { 
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_military_intelligence_1 duration = 1825 }
			every_country = {
				limit = { war_with = ROOT }
				remove_fow = 2
			}
			if = {
				limit = { has_unlocked_magic_school = { school = enchantment level = 2 } }
				custom_tooltip = magisters_need_60_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_2_enchantment_tt
			}
		}
		
		custom_tooltip = magic_scrying_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_enchantment
		}
	}
	tooltip = "Overwrite Fear"
}
custom_button = {
    name = magic_menu_weaken_minds
    
    potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = enchantment level = 1 } } }
			has_unlocked_magic_school = { school = enchantment level = 1 }
		}
		has_mana = { mana = 50 }
		if = {
			limit = {has_country_modifier = enchantment_school_reform_modifier}
			NOT = {has_country_modifier = enchantment_school_reform_modifier}
		}
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
		if = {
			limit = { any_enemy_country = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			any_enemy_country = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
		}
	}
	effect = {
		if = {
			limit = { has_mana = { mana = 50 } }
			add_mana_effect = { mana = -50 }
			hidden_effect = {
				add_country_modifier = { name = enchantment_school_reform_modifier_flag duration = 730 }
			}
			tooltip = {
				custom_tooltip = every_war_enemy_tt
				add_country_modifier = { name = enchantment_school_reform_modifier duration = 730 }
			}
		}
		else = {
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50}
				custom_tooltip = every_war_enemy_tt
				add_country_modifier = { name = enchantment_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_enchantment
		}
	}
	tooltip = "Weaken Minds"
}
custom_button = {
    name = magic_menu_rite_of_conception_spell
    
    potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = enchantment level = 1 } } }
			has_unlocked_magic_school = { school = enchantment level = 1 }
		}
		has_consort = yes
		has_government_attribute = heir
		is_lesser_in_union = no
		NOT = { ruler_is_immortal = yes } # No lich babies	
		has_mana = { mana = 75 }
	}
	effect = {
		if = {
			limit = { has_heir = yes }
			add_legitimacy = -25
		}
		add_mana_effect = { mana = -75 }
		custom_tooltip = magic_estate_rite_of_conception_tooltip
		
		custom_tooltip = magic_conception_desc_tt
		hidden_effect = {
			country_event = { id = acolyte_estate.9 }
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_enchantment
		}
	}
	tooltip = "Rite of Conception"
}
custom_button = {
    name = magic_menu_mind_control_spell
    
    potential = {
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = enchantment level = 3 } } }
			has_unlocked_magic_school = { school = enchantment level = 3 }
		}
		OR = {
			custom_trigger_tooltip = {
				tooltip = magic_menu_mind_control_spell_adm_tt
				NOT = { has_country_modifier = magic_menu_mind_control_spell_adm_modifier }
			}
			custom_trigger_tooltip = {
				tooltip = magic_menu_mind_control_spell_dip_tt
				NOT = { has_country_modifier = magic_menu_mind_control_spell_dip_modifier }
			}
			custom_trigger_tooltip = {
				tooltip = magic_menu_mind_control_spell_mil_tt
				NOT = { has_country_modifier = magic_menu_mind_control_spell_mil_modifier }
			}
		}
		has_mana = { mana = 50 }
	}
	effect = {
		add_mana_effect = { mana = -50 }
		custom_tooltip = magic_menu_mind_control_spell_tooltip
		
		custom_tooltip = magic_mind_control_desc_tt
		hidden_effect = {
			country_event = { id = bertus_changes.6040 }
		}
	}
	tooltip = "Control Mind"
}
custom_button = {
	name = abjuration_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_abjuration }
				clr_country_flag = estate_mages_cast_spell_abjuration
			}
			else = {
				set_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Abjuration School"
}
custom_window = {
	name = magic_menu_abjuration_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
	}
}
custom_icon = {
	name = abjuration_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	tooltip = abjuration_school_spells_tt
}
custom_button = {
	name = upgrade_icon_abjuration
	potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = abjuration level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = abjuration }
	}
	tooltip = "Upgrade Abjuration"
}
custom_icon = {
	name = abjuration_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = abjuration level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = abjuration level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = abjuration level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_abjuration_shield
    
    potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = abjuration level = 2 } } }
			has_unlocked_magic_school = { school = abjuration level = 2 }
		}
		has_mana = { mana = 25 }
		if = {
			limit = {has_country_modifier = abjuration_shield_1_modifier}
			NOT = {has_country_modifier = abjuration_shield_1_modifier}
		}
		if = {
			limit = {has_country_modifier = abjuration_shield_2_modifier}
			NOT = {has_country_modifier = abjuration_shield_2_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_unlocked_magic_school = { school = abjuration level = 3 } has_mana = { mana = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = abjuration_shield_2_modifier duration = 365 }
		}
		else = {
			add_mana_effect = { mana = -25 }
			add_country_modifier = { name = abjuration_shield_1_modifier duration = 365 }
			if = {
				limit = { has_unlocked_magic_school = { school = abjuration level = 3 } }
				custom_tooltip = magisters_need_50_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_abjuration_tt
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_abjuration
		}
	}
	tooltip = "Abjuration Shield"
}
custom_button = {
    name = magic_menu_banishment_spell
    
    potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = abjuration level = 3 } } }
			has_unlocked_magic_school = { school = abjuration level = 3 }
		}
		has_mana = { mana = 75 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_diplomatic_actions_spell_tt
			always = no
		}
		if = {
			limit = { FROM = { has_country_modifier = spell_banished_army_modifier } }
			FROM = { NOT = { has_country_modifier = spell_banished_army_modifier } }
		}
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
		if = {
			limit = { any_enemy_country = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			any_enemy_country = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
		}
	}
	effect = {
		tooltip = {
			if = {
				limit = { has_mana = { mana = 75 } }
				add_mana_effect = { mana = -75 }
			}
			custom_tooltip = "Target Country gets:"
			add_country_modifier = { name = spell_banished_army_modifier duration = 730 }
		}
	}
	tooltip = "Banishment"
}
custom_button = {
    name = magic_menu_broad_ward
    
    potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = abjuration level = 1 } } }
			has_unlocked_magic_school = { school = abjuration level = 1 }
		}
		has_mana = { mana = 20 }
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_1} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_1} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_2} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_2} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_3} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_3} }
		}
	}
	effect = {
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = abjuration level = 3 }
				has_mana = { mana = 40 }
			}
			add_mana_effect = { mana = -40 }
			custom_tooltip = estate_ward_3_tt
			hidden_effect = {
				every_owned_province = {
					limit = {
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_broad_ward_3 duration = 1825 }
				}
			}
		}
		else_if = { 
			limit = { 
				has_unlocked_magic_school = { school = abjuration level = 2 }
				has_mana = { mana = 30 }
			}
			add_mana_effect = { mana = -30 }
			custom_tooltip = estate_ward_2_tt
			if = {
				limit = { has_unlocked_magic_school = { school = abjuration level = 3 } }
				custom_tooltip = magisters_need_40_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_abjuration_tt
			}
			hidden_effect = {
				every_owned_province = {
					limit = {
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_broad_ward_2 duration = 1825 }
				}
			}
		}
		else = { 
			add_mana_effect = { mana = -20 }
			custom_tooltip = estate_ward_1_tt
			custom_tooltip = magisters_need_30_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
			hidden_effect = {
				every_owned_province = {
					limit = {
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_broad_ward_1 duration = 1825 }
				}
			}
		}
		
		custom_tooltip = magic_ward_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_abjuration
		}
	}
	tooltip = "Broad Ward"
}
custom_button = {
    name = magic_menu_narrow_wards
    
    potential = {
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = abjuration level = 1 } } }
			has_unlocked_magic_school = { school = abjuration level = 1 }
		}
		has_mana = { mana = 30 }
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_ward_1} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_ward_1} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_ward_2} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_ward_2} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_ward_3} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_ward_3} }
		}
	}
	effect = {
		if = { 
			limit = {
				has_unlocked_magic_school = { school = abjuration level = 3 }
				has_mana = { mana = 50 }
			}
			add_mana_effect = { mana = -50 }
			capital_scope = {
				every_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_building = mage_tower
							NOT = { province_distance = { who = PREV distance = 75 } }
						}
						has_no_ward_province_modifiers = yes
						is_city = yes							
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_ward_3 duration = 1825 }
				}
			}
		}
		else_if = { 
			limit = { 
				has_unlocked_magic_school = { school = abjuration level = 2 }
				has_mana = { mana = 40 }
			}
			add_mana_effect = { mana = -40 }
			capital_scope = {
				every_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_building = mage_tower
							NOT = { province_distance = { who = PREV distance = 50 } }
						}
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_ward_2 duration = 1825 }
				}
			}
			if = {
				limit = { has_unlocked_magic_school = { school = abjuration level = 3 } }
				custom_tooltip = magisters_need_50_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_abjuration_tt
			}
		}
		else = {
			add_mana_effect = { mana = -30 }
			capital_scope = {
				every_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_building = mage_tower
							NOT = { province_distance = { who = PREV distance = 25 } }
						}
						has_no_ward_province_modifiers = yes
						is_city = yes							
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_ward_1 duration = 1825 }
				}
			}
			if = {
				limit = { has_unlocked_magic_school = { school = abjuration level = 2 } }
				custom_tooltip = magisters_need_40_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_2_abjuration_tt
			}
		}
		custom_tooltip = magic_ward_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_abjuration
		}
	}
	tooltip = "Narrow Wards"
}
custom_button = {
	name = transmutation_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_transmutation }
				clr_country_flag = estate_mages_cast_spell_transmutation
			}
			else = {
				set_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Transmutation School"
}
custom_window = {
	name = magic_menu_transmutation_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_transmutation
	}
}
custom_icon = {
	name = transmutation_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_transmutation
	}
	tooltip = transmutation_school_spells_tt
}
custom_button = {
	name = upgrade_icon_transmutation
	potential = {
		has_country_flag = estate_mages_cast_spell_transmutation
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = transmutation level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = transmutation }
	}
	tooltip = "Upgrade Transmutation"
}
custom_icon = {
	name = transmutation_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = transmutation level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = transmutation level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = transmutation level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_plant_growth
    
    potential = {
		has_country_flag = estate_mages_cast_spell_transmutation
	}

	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = transmutation level = 1 } } }
			has_unlocked_magic_school = { school = transmutation level = 1 }
		}
		any_owned_province = { plant_growth_target = yes }
		has_mana = { mana = 30 }
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_1} }
			custom_trigger_tooltip = {
				tooltip = no_province_with_plant_growth_tt
				NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_1} }
			}
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_2} }
			custom_trigger_tooltip = {
				tooltip = no_province_with_plant_growth_tt
				NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_2} }
			}
			NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_2} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_3} }
			custom_trigger_tooltip = {
				tooltip = no_province_with_plant_growth_tt
				NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_3} }
			}
		}
	}
	effect = {
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = transmutation level = 3 }
				has_mana = { mana = 50 }
			}
			add_mana_effect = { mana = -50 }
			custom_tooltip = plant_growth_3_tt
			hidden_effect = {
				every_owned_province = {
					limit = {  plant_growth_target = yes }
					add_province_modifier = { name = magic_realm_transmutation_plant_growth_3 duration = 3650 }
				}
			}
		}
		else_if = { 
			limit = { 
				has_unlocked_magic_school = { school = transmutation level = 2 }
				has_mana = { mana = 40 }
			}
			add_mana_effect = { mana = -40 }
			custom_tooltip = plant_growth_2_tt
			if = {
				limit = { has_unlocked_magic_school = { school = transmutation level = 3 } }
				custom_tooltip = magisters_need_50_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_transmutation_tt
			}
			hidden_effect = {
				every_owned_province = {
					limit = { plant_growth_target = yes }
					add_province_modifier = { name = magic_realm_transmutation_plant_growth_2 duration = 3650 }
				} 
			}
		}
		else = {
			add_mana_effect = { mana = -30 }
			custom_tooltip = plant_growth_1_tt
			if = {
				limit = { has_unlocked_magic_school = { school = transmutation level = 2 } }
				custom_tooltip = magisters_need_40_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_2_transmutation_tt
			}
			hidden_effect = {
				every_owned_province = {
					limit = {  plant_growth_target = yes }
					add_province_modifier = { name = magic_realm_transmutation_plant_growth_1 duration = 3650 }
				}
			}
		}
		
		custom_tooltip = plant_growth_devastation_tooltip
		hidden_effect = { country_event = { id = magic_estate.100 } } #Devastation ticks up
		
		custom_tooltip = magic_plant_growth_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_transmutation
		}
	}
	tooltip = "Pland Growth"
}
custom_button = {
    name = magic_menu_healing_spells
    
    potential = {
		has_country_flag = estate_mages_cast_spell_transmutation
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = transmutation level = 2 } } }
			has_unlocked_magic_school = { school = transmutation level = 2 }
		}
		has_mana = { mana = 50 }
		if = {
			limit = {has_country_modifier = transmutation_school_reform_modifier}
			NOT = {has_country_modifier = transmutation_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_mana = { mana = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = transmutation_school_reform_modifier duration = 730 }
			hidden_effect = {
				add_country_modifier = { name = transmutation_school_reform_marine_modifier duration = 730 hidden = yes }
				add_country_modifier = { name = transmutation_school_reform_undead_modifier duration = 730 hidden = yes }
			}
		}
		else = {
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = transmutation_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_transmutation
		}
	}
	tooltip = "Healing Spells"
}
custom_button = {
	name = gold_transmutation_spell
    potential = {
		has_country_flag = estate_mages_cast_spell_transmutation
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = transmutation level = 2 } } }
			has_unlocked_magic_school = { school = transmutation level = 2 }
		}
		has_mana = { mana = 33 }
	}
	effect = {
		add_mana_effect = { mana = -33 }
		if = {
			limit = { has_unlocked_magic_school = { school = transmutation level = 3 } }
			add_years_of_income = 0.50
			add_inflation = 4
		}
		else = {
			add_years_of_income = 0.25
			add_inflation = 2
		}
		custom_tooltip = gold_transmutation_spell_tooltip
		custom_tooltip = gold_transmutation_spell_lore_tooltip
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_transmutation
		}
	}
	tooltip = "Gold Transmutation"
}
custom_button = {
	name = evocation_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_evocation }
				clr_country_flag = estate_mages_cast_spell_evocation
			}
			else = {
				set_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Evocation School"
}
custom_window = {
	name = magic_menu_evocation_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_evocation
	}
}
custom_icon = {
	name = evocation_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_evocation
	}
	tooltip = evocation_school_spells_tt
}
custom_button = {
	name = upgrade_icon_evocation
	potential = {
		has_country_flag = estate_mages_cast_spell_evocation
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = evocation level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = evocation }
	}
	tooltip = "Upgrade Evocation"
}
custom_icon = {
	name = evocation_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = evocation level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = evocation level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = evocation level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
	name = fire_ball_spell_icon
	
    potential = {
		has_country_flag = estate_mages_cast_spell_evocation
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = evocation level = 1 } } }
			has_unlocked_magic_school = { school = evocation level = 1 }
		}
		has_mana = { mana = 20 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_siege_spell_tt
			always = no
		}
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	effect = {
		tooltip = {
			add_mana_effect = { mana = -20 }
			if = {
				limit = { has_unlocked_magic_school = { school = evocation level = 3 } }
				custom_tooltip = "Target Province gets:"
				custom_tooltip = change_siege_progress_by_3_tt
			}
			else_if = {
				limit = { has_unlocked_magic_school = { school = evocation level = 2 } }
				custom_tooltip = "Target Province gets:"
				custom_tooltip = change_siege_progress_by_2_tt
			}
			else = {
				custom_tooltip = "Target Province gets:"
				custom_tooltip = change_siege_progress_by_1_tt
			}
		}
	}
	tooltip = fire_ball_spell_icon_tt
}
custom_button = {
	name = earthquake_spell_icon
	
    potential = {
		has_country_flag = estate_mages_cast_spell_evocation
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = evocation level = 2 } } }
			has_unlocked_magic_school = { school = evocation level = 2 }
		}
		has_mana = { mana = 60 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_siege_spell_tt
			always = no
		}
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	effect = {
		tooltip = {
			add_mana_effect = { mana = -60 }
			custom_tooltip = "Target Province gets:"
			custom_tooltip = change_siege_progress_by_4_tt
			add_province_modifier = {name = siege_magic_earthquake duration = 365}
			add_base_tax = -1
			add_base_production = -1
			add_base_manpower = -1
			add_devastation = 10
		}
	}
	tooltip = earthquake_spell_icon_tt
}
custom_button = {
    name = magic_menu_evocated_weapons
    
    potential = {
		has_country_flag = estate_mages_cast_spell_evocation
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = evocation level = 1 } } }
			has_unlocked_magic_school = { school = evocation level = 1 }
		}
		has_mana = { mana = 50 }
		if = {
			limit = {has_country_modifier = evocation_school_reform_modifier}
			NOT = {has_country_modifier = evocation_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_mana = { mana = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = evocation_school_reform_modifier duration = 730 }
		}
		else = {
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = evocation_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_transmutation
		}
	}
	tooltip = "Evocated Weapons"
}
custom_button = {
	name = illusion_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_illusion }
				clr_country_flag = estate_mages_cast_spell_illusion
			}
			else = {
				set_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Illusion School"
}
custom_window = {
	name = magic_menu_illusion_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_illusion
	}
}
custom_icon = {
	name = illusion_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_illusion
	}
	tooltip = illusion_school_spells_tt
}
custom_button = {
	name = upgrade_icon_illusion
	potential = {
		has_country_flag = estate_mages_cast_spell_illusion
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = illusion level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = illusion }
	}
	tooltip = "Upgrade Illusion"
}
custom_icon = {
	name = illusion_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = illusion level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = illusion level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = illusion level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_delusions
    
    potential = {
		has_country_flag = estate_mages_cast_spell_illusion
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = illusion level = 1 } } }
			has_unlocked_magic_school = { school = illusion level = 1 }
		}
		has_mana = { mana = 50 }
		if = {
			limit = {has_country_modifier = illusion_school_reform_modifier}
			NOT = {has_country_modifier = illusion_school_reform_modifier}
		}
		if = {
			limit = { any_enemy_country = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			any_enemy_country = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
		}
	}
	effect = {
		if = {
			limit = { has_mana = { mana = 50 } }
			add_mana_effect = { mana = -50 }
			tooltip = {
				custom_tooltip = "Every owned province get:"
				add_province_modifier = { name = illusion_school_reform_modifier duration = 730 }
			}
			hidden_effect = {
				every_owned_province = { add_province_modifier = { name = illusion_school_reform_modifier duration = 730 } }
			}
		}
		else = {
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				custom_tooltip = "Every owned province get:"
				add_province_modifier = { name = illusion_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_illusion
		}
	}
	tooltip = "Delusions"
}
custom_button = {
    name = magic_menu_fake_comet_spell
    
    potential = {
		has_country_flag = estate_mages_cast_spell_illusion
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = illusion level = 2 } } }
			has_unlocked_magic_school = { school = illusion level = 2 }
		}
		has_mana = { mana = 75 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_diplomatic_actions_spell_tt
			always = no
		}
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	effect = {
		tooltip = {
			add_mana_effect = { mana = -75 }
			custom_tooltip = "Target Country gets:"
			country_event = { id = 5060 days = 5 random = 20 }
		}
	}
	tooltip = "Comet Illusion"
}
custom_button = {
	name = necromancy_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_necromancy }
				clr_country_flag = estate_mages_cast_spell_necromancy
			}
			else = {
				set_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Necromancy School"
}
custom_window = {
	name = magic_menu_necromancy_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_necromancy
	}
}
custom_icon = {
	name = necromancy_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_necromancy
	}
	tooltip = necromancy_school_spells_tt
}
custom_button = {
	name = upgrade_icon_necromancy
	potential = {
		has_country_flag = estate_mages_cast_spell_necromancy
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = necromancy level = 3 } } 
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = necromancy }
	}
	tooltip = "Upgrade Necromancy"
}
custom_icon = {
	name = necromancy_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = necromancy level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = necromancy level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = necromancy level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_flesh_necrosis
    
    potential = {
		has_country_flag = estate_mages_cast_spell_necromancy
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = necromancy level = 1 } } }
			has_unlocked_magic_school = { school = necromancy level = 1 }
		}
		if = {
			limit = { any_enemy_country = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			any_enemy_country = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
		}
		has_mana = { mana = 50 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_diplomatic_actions_spell_tt
			always = no
		}
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	effect = {
		tooltip = {
			if = {
				limit = { has_mana = { mana = 50 } }
				add_mana_effect = { mana = -50 }
				custom_tooltip = "Target Country gets:"
				if = {
					limit = { has_unlocked_magic_school = { school = necromancy level = 2 } }
					add_country_modifier = { name = spell_flesh_necrosis_2_modifier duration = 730 }
				}
				else = {
					add_country_modifier = { name = spell_flesh_necrosis_1_modifier duration = 730 }
					custom_tooltip = magisters_need_tier_2_necromancy_tt
					custom_tooltip = "to get lvl 2 Spell"
				}
			}
			else = {
				custom_tooltip = magisters_need_50_mana_tt
			}
		}
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_necromancy
		}
	}
	tooltip = "Flesh Necrosis"
}
custom_button = {
	name = conjuration_school_spells
    potential = {
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_conjuration }
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
			else = {
				set_country_flag = estate_mages_cast_spell_conjuration
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_divination
			}
		}
	}
	tooltip = "Conjuration School"
}
custom_window = {
	name = magic_menu_conjuration_window
	
    potential = {
		has_country_flag = estate_mages_cast_spell_conjuration
	}
}
custom_icon = {
	name = conjuration_school_icon
    potential = {
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	tooltip = conjuration_school_spells_tt
}
custom_button = {
	name = upgrade_icon_conjuration
	potential = {
		has_country_flag = estate_mages_cast_spell_conjuration
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			tag = A85
		}
		NOT = { has_unlocked_magic_school = { school = conjuration level = 3 } }
		if = {
			limit = { is_colonial_nation = yes }
			is_colonial_nation = no
		}
	}
	trigger = {
		has_mana = { mana = 75 }
	}
	effect = {
		upgrade_magic_shcool = { school = conjuration }
	}
	tooltip = "Upgrade Conjuration"
}
custom_icon = {
	name = conjuration_school_level_icon
	potential = {
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
	frame = {
	    number = 4
	    trigger = { 
			has_unlocked_magic_school = { school = conjuration level = 3 }
		}
	}
	frame = {
	    number = 3
	    trigger = { 
			has_unlocked_magic_school = { school = conjuration level = 2 }
		}
	}
	frame = {
	    number = 2
	    trigger = { 
			has_unlocked_magic_school = { school = conjuration level = 1 }
		}
	}
	frame = { #First matched frame clause will be used.
	    number = 1
	    trigger = { 
		}
	}
}
custom_button = {
    name = magic_menu_magnificent_feast
    
    potential = {
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = conjuration level = 1 } } }
			has_unlocked_magic_school = { school = conjuration level = 1 }
		}
		has_mana = { mana = 10 }
		if = {
			limit = {has_country_modifier = magic_estate_magnificent_feast_1}
			NOT = {has_country_modifier = magic_estate_magnificent_feast_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_magnificent_feast_2}
			NOT = {has_country_modifier = magic_estate_magnificent_feast_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_magnificent_feast_3}
			NOT = {has_country_modifier = magic_estate_magnificent_feast_3}
		}
	}
	effect = {
		#Effect
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = conjuration level = 3 }
				has_mana = { mana = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_magnificent_feast_3 duration = 3650 }
		}
		else_if = { 
			limit = { 
				has_unlocked_magic_school = { school = conjuration level = 2 }
				has_mana = { mana = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_magnificent_feast_2 duration = 3650 }
			if = {
				limit = { has_unlocked_magic_school = { school = conjuration level = 3 } }
				custom_tooltip = magisters_need_30_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_conjuration_tt
			}
		}
		else_if = { 
			limit = { 
				has_mana = { mana = 10 }
			}
			add_mana_effect = { mana = -10 }
			add_country_modifier = { name = magic_estate_magnificent_feast_1 duration = 3650 }
			if = {
				limit = { has_unlocked_magic_school = { school = conjuration level = 2 } }
				custom_tooltip = magisters_need_20_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_2_conjuration_tt
			}
		}
		custom_tooltip = magic_feast_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_conjuration
		}
	}
	tooltip = "Magnificent Feast"
}
custom_button = {
    name = magic_menu_elemental_summoning
    
    potential = {
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = conjuration level = 1 } } }
			has_unlocked_magic_school = { school = conjuration level = 1 }
		}
		has_mana = { mana = 50 }
		if = {
			limit = {has_country_modifier = conjuration_school_reform_modifier}
			NOT = {has_country_modifier = conjuration_school_reform_modifier}
		}
	}
	effect = {
		add_mana_effect = { mana = -50 }
		add_country_modifier = { name = conjuration_school_reform_modifier duration = 730 }
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_conjuration
		}
	}
	tooltip = "Elemental Summoning"
}
custom_button = {
    name = magic_menu_aid_constructions
    
    potential = {
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	trigger = {
		if = {
			limit = { NOT = { has_unlocked_magic_school = { school = conjuration level = 1 } } }
			has_unlocked_magic_school = { school = conjuration level = 1 }
		}
		has_mana = { mana = 50 }
		if = {
			limit = {has_country_modifier = magic_estate_aiding_construction_1}
			NOT = {has_country_modifier = magic_estate_aiding_construction_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_aiding_construction_2}
			NOT = {has_country_modifier = magic_estate_aiding_construction_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_aiding_construction_3}
			NOT = {has_country_modifier = magic_estate_aiding_construction_3}
		}
	}
	effect = {
		if = { 
			limit = { 
				has_unlocked_magic_school = { school = conjuration level = 3 }
				has_mana = { mana = 90 }
			}
			add_mana_effect = { mana = -90 }
			add_country_modifier = { name = magic_estate_aiding_construction_3 duration = 3650 }
			hidden_effect = {
				remove_country_modifier = magic_estate_aiding_construction_1
				remove_country_modifier = magic_estate_aiding_construction_2
			}
		}
		else_if = {
			limit = {
				has_unlocked_magic_school = { school = conjuration level = 2 }
				NOT = {has_country_modifier = magic_estate_aiding_construction_3}
				has_mana = { mana = 70 }
			}
			add_mana_effect = { mana = -70 }
			add_country_modifier = { name = magic_estate_aiding_construction_2 duration = 3650 }
			hidden_effect = {
				remove_country_modifier = magic_estate_aiding_construction_1
			}
			if = {
				limit = { has_unlocked_magic_school = { school = conjuration level = 3 } }
				custom_tooltip = magisters_need_90_mana_tt
				custom_tooltip = "to get lvl 3 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_3_conjuration_tt
			}
		}
		else_if = {
			limit = {
				NOT = {has_country_modifier = magic_estate_aiding_construction_3}
				NOT = {has_country_modifier = magic_estate_aiding_construction_2}
				has_mana = { mana = 50 }
			}
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = magic_estate_aiding_construction_1 duration = 3650 }
			if = {
				limit = { has_unlocked_magic_school = { school = conjuration level = 2 } }
				custom_tooltip = magisters_need_70_mana_tt
				custom_tooltip = "to get lvl 2 Spell"
			}
			else = {
				custom_tooltip = magisters_need_tier_2_conjuration_tt
			}
		}
		else_if = {	#already have spell
			limit = {
				OR = {
					has_country_modifier = magic_estate_aiding_construction_1
					has_country_modifier = magic_estate_aiding_construction_2
					has_country_modifier = magic_estate_aiding_construction_3
				}
			}
			custom_tooltip = "Spell Already active"
		}
		else = {
			tooltip = {
				custom_tooltip = "Would give:"
				if = { 
					limit = { has_unlocked_magic_school = { school = conjuration level = 3 } }
					add_mana_effect = { mana = -90 }
					add_country_modifier = { name = magic_estate_aiding_construction_3  duration = 3650 }
				}
				else_if = {
					limit = { has_unlocked_magic_school = { school = conjuration level = 2 } }
					add_mana_effect = { mana = -70 }
					add_country_modifier = { name = magic_estate_aiding_construction_2 duration = 3650 }
				}
				else = {
					add_mana_effect = { mana = -50 }
					add_country_modifier = { name = magic_estate_aiding_construction_1 duration = 3650 }
				}
			}
		}
		
		custom_tooltip = magic_construction_desc_tt
		hidden_effect = {
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_conjuration
		}
	}
	tooltip = "Aid Constructions"
}
custom_button = {
    name = magic_menu_siege
    
    potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { 
			ai = no
			has_estate = estate_mages
			NOT = { has_country_flag = Y63_unlocked_minor_runes }
			#if = { limit = { tag = I02 }	#krak
			#	mission_completed = krak_relighting_forges
			#}
			NOT = { has_estate = estate_acolytes }
			NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
		}
	}
	trigger = {}
	effect = {
		hidden_effect = {
			FROM = {
				if = {
					limit = { NOT = { has_country_flag = siege_cast_spells_flag } }
					set_country_flag = siege_cast_spells_flag
				}
				else = {
					clr_country_flag = siege_cast_spells_flag
				}
			}
		}
	}
	tooltip = "Siege Magic"
}
custom_icon = {
	name = siege_magic_background_icon
	
    potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { has_country_flag = siege_cast_spells_flag }
	}
	tooltip = ""
}
custom_button = {
	name = fire_ball_spell
	potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { has_country_flag = siege_cast_spells_flag }
	}
	trigger = {
		FROM = { 
			if = {
				limit = { NOT = { has_unlocked_magic_school = { school = evocation level = 1 } } }
				has_unlocked_magic_school = { school = evocation level = 1 }
			}
			has_mana = { mana = 20 }
			if = {
				limit = { is_colonial_nation = yes }
				is_colonial_nation = no
			}
			if = {
				limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
				NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			}
		}
		if = {
			limit = { controller = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			controller = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_building = fort_magic }
			NOT = { has_building = fort_magic }
		}
		if = {
			limit = { 
				has_ward_lvl_1_province_modifiers = yes
				NOT = { FROM = { has_unlocked_magic_school = { school = evocation level = 2 } } }
			}
			custom_trigger_tooltip = {
				tooltip = not_has_magic_defensive_spell_1_tt
				NOT = { has_ward_lvl_1_province_modifiers = yes }
			}
		}
		if = {
			limit = { 
				has_ward_lvl_2_province_modifiers = yes
				NOT = { FROM = { has_unlocked_magic_school = { school = evocation level = 3 } } }
			}
			custom_trigger_tooltip = {
				tooltip = not_has_magic_defensive_spell_2_tt
				NOT = { has_ward_lvl_2_province_modifiers = yes }
			}
		}
		if = {
			limit = { has_ward_lvl_2_province_modifiers = yes }
			custom_trigger_tooltip = {
				tooltip = not_has_magic_defensive_spell_3_tt
				NOT = { has_ward_lvl_3_province_modifiers = yes }
			}
		}
	}
	effect = {
		FROM = { add_mana_effect = { mana = -20 } }
		add_province_modifier = { name = fireball_used_flag_modifier duration = 30 hidden = yes }
		if = {
			limit = { FROM = { has_unlocked_magic_school = { school = evocation level = 3 } } }
			custom_tooltip = change_siege_progress_by_3_tt
			hidden_effect = {
				change_siege = 3
				if = {
					limit = { has_ward_lvl_2_province_modifiers = yes }
					change_siege = -2
				}
				else_if = {
					limit = { has_ward_lvl_1_province_modifiers = yes }
					change_siege = -1
				}
			}
		}
		else_if = {
			limit = { FROM = { has_unlocked_magic_school = { school = evocation level = 2 } } }
			custom_tooltip = change_siege_progress_by_2_tt
			hidden_effect = { change_siege = 2 }
			if = {
				limit = { has_ward_lvl_2_province_modifiers = yes }
				change_siege = -1
			}
		}
		else = {
			custom_tooltip = change_siege_progress_by_1_tt
			hidden_effect = { change_siege = 1 }
		}
	}
	tooltip = "Fire Ball"
}
custom_button = {
	name = earthquake_spell
	potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { has_country_flag = siege_cast_spells_flag }
	}
	trigger = {
		FROM = {
			if = {
				limit = { NOT = { has_unlocked_magic_school = { school = evocation level = 2 } } }
				has_unlocked_magic_school = { school = evocation level = 2 }
			}
			has_mana = { mana = 60 }
			if = {
				limit = { is_colonial_nation = yes }
				is_colonial_nation = no
			}
			if = {
				limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
				NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			}
		}
		if = {
			limit = { controller = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			controller = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_building = fort_magic }
			NOT = { has_building = fort_magic }
		}
		if = {
			limit = { has_province_modifier = dookan_shake_the_earth_province }
			NOT = { has_province_modifier = dookan_shake_the_earth_province }
		}
		if = {
			limit = { has_province_modifier = siege_magic_earthquake }
			NOT = { has_province_modifier = siege_magic_earthquake }
		}
		if = {
			limit = { 
				has_ward_lvl_2_province_modifiers = yes
				NOT = { FROM = { has_unlocked_magic_school = { school = evocation level = 3 } } }
			}
			custom_trigger_tooltip = {
				tooltip = not_has_magic_defensive_spell_2_tt
				NOT = { has_ward_lvl_2_province_modifiers = yes }
			}
		}
		if = {
			limit = { has_ward_lvl_2_province_modifiers = yes }
			custom_trigger_tooltip = {
				tooltip = not_has_magic_defensive_spell_3_tt
				NOT = { has_ward_lvl_3_province_modifiers = yes }
			}
		}
	}
	effect = {
		FROM = { add_mana_effect = { mana = -60 } }
		add_province_modifier = { name = siege_magic_earthquake duration = 30 hidden = yes }
		if = {
			limit = { FROM = { has_unlocked_magic_school = { school = evocation level = 3 } } }
			custom_tooltip = change_siege_progress_by_6_tt
			hidden_effect = { change_siege = 6 }
			add_province_modifier = {name = siege_magic_earthquake duration = 730}
			add_base_tax = -2
			add_base_production = -2
			add_base_manpower = -2
			add_devastation = 20
			if = {
				limit = { has_ward_lvl_2_province_modifiers = yes }
				hidden_effect = { change_siege = -3 add_devastation = -10 }
			}
			else_if = {
				limit = { has_ward_lvl_1_province_modifiers = yes }
				hidden_effect = { change_siege = -1 add_devastation = -5 }
			}
		}
		else = {
			custom_tooltip = change_siege_progress_by_4_tt
			hidden_effect = { change_siege = 4 }
			add_province_modifier = {name = siege_magic_earthquake duration = 365}
			add_base_tax = -1
			add_base_production = -1
			add_base_manpower = -1
			add_devastation = 10
			if = {
				limit = { has_ward_lvl_1_province_modifiers = yes }
				hidden_effect = { change_siege = -2 add_devastation = -5 }
			}
		}
	}
	tooltip = "Earthquake"
}

custom_button = {
	name = meteor_strike_spell
	potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { has_country_flag = siege_cast_spells_flag }
	}
	trigger = {
		FROM = {
			if = {
				limit = { NOT = { has_ruler_flag = evocation_3 } }
				is_evocation_3 = yes
			}
			has_mana = { mana = 100 }
			if = {
				limit = { is_colonial_nation = yes }
				is_colonial_nation = no
			}
			if = {
				limit = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
				NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier }
			}
		}
		if = {
			limit = { controller = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
			controller = {  NOT = { has_country_modifier = tactical_deck_engage_in_negotiations_modifier } }
		}
		if = {
			limit = { has_building = fort_magic }
			NOT = { has_building = fort_magic }
		}
	}
	effect = {
		FROM = { add_mana_effect = { mana = -100 } }
		if = {
			limit = { has_ward_lvl_3_province_modifiers = yes }
			add_devastation = 25
			add_base_tax = -1
			add_base_production = -1
			add_base_manpower = -1
			add_province_modifier = { name = meteor_strike_mark_modifier duration = 1825 }
		}
		else = {
			if = {
				limit = { has_ward_lvl_2_province_modifiers = yes }
				custom_tooltip = change_siege_progress_by_4_tt
				hidden_effect = { change_siege = 4 }
				add_devastation = 50
				add_base_tax = -3
				add_base_production = -3
				add_base_manpower = -3
			}
			else_if = {
				limit = { has_ward_lvl_1_province_modifiers = yes }
				custom_tooltip = change_siege_progress_by_6_tt
				hidden_effect = { change_siege = 6 }
				add_devastation = 75
				add_base_tax = -4
				add_base_production = -4
				add_base_manpower = -4
			}
			else = {
				custom_tooltip = change_siege_progress_by_8_tt
				hidden_effect = { change_siege = 8 }
				add_devastation = 100
				add_base_tax = -5
				add_base_production = -5
				add_base_manpower = -5
			}
			add_province_modifier = { name = meteor_strike_modifier duration = 182 }
			add_province_modifier = { name = meteor_strike_mark_modifier duration = 3650 }
			if = { limit = {has_building = fort_18th} remove_building = fort_18th add_building = fort_16th }
			else_if = { limit = {has_building = fort_17th} remove_building = fort_17th add_building = fort_15th }
			else_if = { limit = {has_building = fort_16th} remove_building = fort_16th }
			else_if = { limit = {has_building = fort_15th} remove_building = fort_15th }
		}
	}
	tooltip = "Meteor Strike"
}