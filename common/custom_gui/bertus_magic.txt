
custom_button = {
    name = magic_menu_estate
    
    potential = {
		ai = no
		has_estate = estate_mages
		NOT = { has_country_flag = Y63_unlocked_minor_runes }
		if = { limit = { tag = I02 }	#krak
			mission_completed = krak_relighting_forges
		}
		NOT = { has_estate = estate_acolytes }
		NOT = { has_estate_privilege = artifice_invention_korashi_tuners }
	}
	trigger = {}
	effect = {
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				set_country_flag = estate_mages_cast_spells
			}
			else = {
				clr_country_flag = estate_mages_cast_spells
			}
			if = {
				limit = { has_country_flag = estate_artificers_innovations_flag }
				clr_country_flag = estate_artificers_innovations_flag
			}
		}
	}
	tooltip = "Cast Spell"
}
custom_icon = {
	name = topbar_mana_overlay
	
    potential = {
		ai = no	
	}
	tooltip = ""
}
custom_text_box = {
	name = magic_menu_topbar_mana_overlay_value
	
    potential = {
		ai = no	
	}
	tooltip = magic_menu_topbar_mana_overlay_value_tt
}
custom_icon = {
	name = magic_menu_background
	
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_icon = {
	name = magic_menu_mana_frame
	
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_icon = {
	name = magic_menu_mana
	
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = magic_menu_mana_tt
	frame = { number = 20 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 100 } } }
	frame = { number = 19 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 95 } } }
	frame = { number = 18 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 90 } } }
	frame = { number = 17 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 85 } } }
	frame = { number = 16 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 80 } } }
	frame = { number = 15 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 } } }
	frame = { number = 14 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 70 } } }
	frame = { number = 13 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 65 } } }
	frame = { number = 12 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 60 } } }
	frame = { number = 11 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 55 } } }
	frame = { number = 10 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } } }
	frame = { number = 9 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 45 } } }
	frame = { number = 8 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 40 } } }
	frame = { number = 7 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 35 } } }
	frame = { number = 6 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 } } }
	frame = { number = 5 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 25 } } }
	frame = { number = 4 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 } } }
	frame = { number = 3 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 15 } } }
	frame = { number = 2 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 10 } } }
	frame = { number = 1 trigger = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 5 	} } }
	frame = { number = 21 trigger = { } }
}
custom_icon = {
	name = magic_menu_spell_strength
	
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_text_box = {
	name = magic_menu_spell_strength_text
	
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	tooltip = ""
}
custom_button = {
	name = divination_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = divination_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = divination_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_divination }
				clr_country_flag = estate_mages_cast_spell_divination
			}
			else = {
				set_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Divination School"
}
custom_icon = {
	name = divination_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_divination
	}
	tooltip = "Divination School"
}
custom_button = {
	name = enchantment_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = enchantment_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = enchantment_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_enchantment }
				clr_country_flag = estate_mages_cast_spell_enchantment
			}
			else = {
				set_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Enchantment School"
}
custom_icon = {
	name = enchantment_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	tooltip = "Enchantment School"
}
custom_button = {
	name = abjuration_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = abjuration_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = abjuration_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_abjuration }
				clr_country_flag = estate_mages_cast_spell_abjuration
			}
			else = {
				set_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Abjuration School"
}
custom_icon = {
	name = abjuration_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	tooltip = "Abjuration School"
}
custom_button = {
    name = magic_menu_abjuration_shield
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = abjuration_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = abjuration_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = abjuration_school_reform_modifier}
			NOT = {has_country_modifier = abjuration_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = abjuration_school_reform_modifier duration = 730 }
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = abjuration_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_abjuration
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Abjuration Shield"
}
custom_button = {
    name = magic_menu_banishment_spell
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_illusion
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = transmutation_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = transmutation_school_reform }
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_diplomatic_actions_spell_tt
			always = no
		}
		if = {
			limit = { FROM = { has_country_modifier = spell_banished_army_modifier } }
			FROM = { NOT = { has_country_modifier = spell_banished_army_modifier } }
		}
	}
	effect = {
		tooltip = {
			if = {
				limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 } }
				add_mana_effect = { mana = -75 }
			}
			else = {
				custom_tooltip = magisters_need_75_mana_tt
				tooltip = {
					FROM = { add_country_modifier = { name = spell_banished_army_modifier duration = 730 } }
				}
			}
		}
	}
	tooltip = "Banishment"
}
custom_button = {
    name = magic_menu_broad_ward
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_1} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_1} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_2} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_2} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_3} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_broad_ward_3} }
		}
	}
	effect = {
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 40 }
			}
			add_mana_effect = { mana = -40 }
			custom_tooltip = estate_ward_3_tt
			hidden_effect = {
				every_owned_province = {
					limit = {
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_broad_ward_3 duration = 1825 }
				}
			}
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
			}
			add_mana_effect = { mana = -30 }
			custom_tooltip = estate_ward_2_tt
			custom_tooltip = magisters_need_40_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
			hidden_effect = {
				every_owned_province = {
					limit = {
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_broad_ward_2 duration = 1825 }
				}
			}
		}
		else_if = { 
			limit = { 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
			}
			add_mana_effect = { mana = -20 }
			custom_tooltip = estate_ward_1_tt
			custom_tooltip = magisters_need_30_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
			hidden_effect = {
				every_owned_province = {
					limit = {
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_broad_ward_1 duration = 1825 }
				}
			}
		}
		else = {
			custom_tooltip = magisters_need_20_30_40_mana_tt
		}
		
		custom_tooltip = magic_ward_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_abjuration
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Broad Ward"
}
custom_button = {
    name = magic_menu_narrow_wards
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_abjuration
	}
	trigger = {
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_ward_1} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_ward_1} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_ward_2} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_ward_2} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_estate_ward_3} }
			NOT = {any_owned_province = { has_province_modifier = magic_estate_ward_3} }
		}
	}
	effect = {
		if = { 
			limit = {
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
			}

			add_mana_effect = { mana = -50 }
			capital_scope = {
				every_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_building = mage_tower
							NOT = { province_distance = { who = PREV distance = 75 } }
						}
						has_no_ward_province_modifiers = yes
						is_city = yes							
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_ward_3 duration = 1825 }
				}
			}
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 40 }
			}
			add_mana_effect = { mana = -40 }
			capital_scope = {
				every_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_building = mage_tower
							NOT = { province_distance = { who = PREV distance = 50 } }
						}
						has_no_ward_province_modifiers = yes
						is_city = yes
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_ward_2 duration = 1825 }
				}
			}
			custom_tooltip = magisters_need_50_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else_if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 } }
			add_mana_effect = { mana = -30 }
			capital_scope = {
				every_province = {
					limit = {
						owned_by = ROOT
						OR = {
							has_building = mage_tower
							NOT = { province_distance = { who = PREV distance = 25 } }
						}
						has_no_ward_province_modifiers = yes
						is_city = yes							
						OR = {
							fort_level = 2
							is_capital = yes
						}
					}
					add_province_modifier = { name = magic_estate_ward_1 duration = 1825 }
				}
			}
			custom_tooltip = magisters_need_40_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		else = {
			custom_tooltip = magisters_need_30_40_50_mana_tt
		}
		custom_tooltip = magic_ward_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_abjuration
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Broad Wards"
}
custom_button = {
	name = transmutation_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = transmutation_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = transmutation_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_transmutation }
				clr_country_flag = estate_mages_cast_spell_transmutation
			}
			else = {
				set_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Transmutation School"
}
custom_icon = {
	name = transmutation_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_transmutation
	}
	tooltip = "Transmutation School"
}
custom_button = {
	name = evocation_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = evocation_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = evocation_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_evocation }
				clr_country_flag = estate_mages_cast_spell_evocation
			}
			else = {
				set_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Evocation School"
}
custom_icon = {
	name = evocation_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_evocation
	}
	tooltip = "Evocation School"
}
custom_button = {
	name = illusion_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = illusion_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = illusion_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_illusion }
				clr_country_flag = estate_mages_cast_spell_illusion
			}
			else = {
				set_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Illusion School"
}
custom_icon = {
	name = illusion_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_illusion
	}
	tooltip = "Illusion School"
}
custom_button = {
	name = necromancy_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = necromancy_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = necromancy_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_necromancy }
				clr_country_flag = estate_mages_cast_spell_necromancy
			}
			else = {
				set_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_divination
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
		}
	}
	tooltip = "Necromancy School"
}
custom_icon = {
	name = necromancy_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_necromancy
	}
	tooltip = "Necromancy School"
}
custom_button = {
	name = conjuration_school_spells
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = conjuration_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = conjuration_school_reform }
		}
	}
	effect = {
		if = {
			limit = { ai = no }
			if = {
				limit = { has_country_flag = estate_mages_cast_spell_conjuration }
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
			else = {
				set_country_flag = estate_mages_cast_spell_conjuration
				clr_country_flag = estate_mages_cast_spell_enchantment
				clr_country_flag = estate_mages_cast_spell_abjuration
				clr_country_flag = estate_mages_cast_spell_transmutation
				clr_country_flag = estate_mages_cast_spell_evocation
				clr_country_flag = estate_mages_cast_spell_illusion
				clr_country_flag = estate_mages_cast_spell_necromancy
				clr_country_flag = estate_mages_cast_spell_divination
			}
		}
	}
	tooltip = "Conjuration School"
}
custom_icon = {
	name = conjuration_school_icon
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	tooltip = "Conjuration School"
}
custom_button = {
    name = magic_menu_magnificent_feast
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	trigger = {
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 10 }
		if = {
			limit = {has_country_modifier = magic_estate_magnificent_feast_1}
			NOT = {has_country_modifier = magic_estate_magnificent_feast_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_magnificent_feast_2}
			NOT = {has_country_modifier = magic_estate_magnificent_feast_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_magnificent_feast_3}
			NOT = {has_country_modifier = magic_estate_magnificent_feast_3}
		}
	}
	effect = {
		#Effect
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_magnificent_feast_3 duration = 3650 }
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_magnificent_feast_2 duration = 3650 }
			custom_tooltip = magisters_need_30_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else_if = { 
			limit = { 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 10 }
			}
			add_mana_effect = { mana = -75 }
			add_country_modifier = { name = magic_estate_magnificent_feast_1 duration = 3650 }
			custom_tooltip = magisters_need_20_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		else = {
			custom_tooltip = magisters_need_10_20_30_mana_tt
		}
		custom_tooltip = magic_feast_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Magnificent Feast"
}
custom_button = {
    name = magic_menu_plant_growth
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_transmutation
	}

	trigger = {
		any_owned_province = { plant_growth_target = yes }
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_1} }
			custom_trigger_tooltip = {
				tooltip = no_province_with_plant_growth_tt
				NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_1} }
			}
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_2} }
			custom_trigger_tooltip = {
				tooltip = no_province_with_plant_growth_tt
				NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_2} }
			}
			NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_2} }
		}
		if = {
			limit = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_3} }
			custom_trigger_tooltip = {
				tooltip = no_province_with_plant_growth_tt
				NOT = {any_owned_province = { has_province_modifier = magic_realm_transmutation_plant_growth_3} }
			}
		}
	}
	effect = {
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
			}
			add_mana_effect = { mana = -50 }
			custom_tooltip = plant_growth_3_tt
			hidden_effect = {
				every_owned_province = {
					limit = {  plant_growth_target = yes }
					add_province_modifier = { name = magic_realm_transmutation_plant_growth_3 duration = 3650 }
				}
			}
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 40 }
			}
			add_mana_effect = { mana = -40 }
			custom_tooltip = plant_growth_2_tt
			custom_tooltip = magisters_need_50_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
			hidden_effect = {
				every_owned_province = {
					limit = { plant_growth_target = yes }
					add_province_modifier = { name = magic_realm_transmutation_plant_growth_2 duration = 3650 }
				} 
			}
		}
		else = {
			add_mana_effect = { mana = -30 }
			custom_tooltip = plant_growth_1_tt
			custom_tooltip = magisters_need_40_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
			hidden_effect = {
				every_owned_province = {
					limit = {  plant_growth_target = yes }
					add_province_modifier = { name = magic_realm_transmutation_plant_growth_1 duration = 3650 }
				}
			}
		}
		
		custom_tooltip = plant_growth_devastation_tooltip
		hidden_effect = { country_event = { id = magic_estate.100 } } #Devastation ticks up
		
		custom_tooltip = magic_plant_growth_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_transmutation
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Pland Growth"
}
custom_button = {
    name = magic_menu_scrying_rivals
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		any_rival_country  = { exists = yes }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_1}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_2}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_3}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_3}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_1}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_2}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_3}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_3}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 10 }
	}
	effect = {
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_rivals_3 duration = 3650 }
			every_rival_country = {
				remove_fow = 4
				add_spy_network_from = { who = ROOT value = 30 }
				add_spy_network_in = { who = ROOT value = -30 } 
			}
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_scrying_rivals_2 duration = 3650 }
			every_rival_country = {
				remove_fow = 3
				add_spy_network_from = { who = ROOT value = 20 }
				add_spy_network_in = { who = ROOT value = -20 }
			}
			custom_tooltip = magisters_need_30_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else = {
			add_mana_effect = { mana = -10 }
			add_country_modifier = { name = magic_estate_scrying_rivals_1 duration = 3650 }
			every_rival_country = {
				remove_fow = 2
				add_spy_network_from = { who = ROOT value = 10 }
				add_spy_network_in = { who = ROOT value = -10 }
			}
			custom_tooltip = magisters_need_20_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_divination
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Scrying Rivals"
}
custom_button = {
    name = magic_menu_scrying_neighbours
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		any_country = { is_neighbor_of = ROOT }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_1}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_2}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_rivals_3}
			NOT = {has_country_modifier = magic_estate_scrying_rivals_3}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_1}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_2}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_neighbours_3}
			NOT = {has_country_modifier = magic_estate_scrying_neighbours_3}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 10 }
	}
	effect = {
		hidden_effect = {
			every_country = { 
				limit = { is_neighbor_of = ROOT }
				country_event = {id = bertus_changes.1113}
			}
		}	
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 } 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_neighbours_3 duration = 3650 }
			custom_tooltip = magic_scrying_fow_3_tt
			hidden_effect = { every_neighbor_country = { remove_fow = 4 } }
			if = { limit = { neighbor_is_ahead_in_institution = yes }
				capital_scope = {
					area = {
						limit = { owned_by = ROOT }
						add_province_modifier = { name = magic_estate_scrying_stealing_institution_3 duration = 3650 }
					}
				}
			}
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 } 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_scrying_neighbours_2 duration = 3650 }
			custom_tooltip = magic_scrying_fow_2_tt
			hidden_effect = { every_neighbor_country = { remove_fow = 3 } }
			if = { limit = { neighbor_is_ahead_in_institution = yes }
				capital_scope = {
					area = {
						limit = { owned_by = ROOT }
						add_province_modifier = { name = magic_estate_scrying_stealing_institution_2 duration = 3650 }
					}
				}
			}
			custom_tooltip = magisters_need_30_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else = {
			add_mana_effect = { mana = -10 }
			add_country_modifier = { name = magic_estate_scrying_neighbours_1 duration = 3650 }
			custom_tooltip = magic_scrying_fow_1_tt
			hidden_effect = { every_neighbor_country = { remove_fow = 2 } }
			if = { limit = { neighbor_is_ahead_in_institution = yes }
				capital_scope = {
					area = {
						limit = { owned_by = ROOT }
						add_province_modifier = { name = magic_estate_scrying_stealing_institution_1 duration = 3650 }
					}
				}
			}
			custom_tooltip = magisters_need_20_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		
		custom_tooltip = magic_scrying_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_divination
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Scrying Neighbours"
}
custom_button = {
    name = magic_menu_scrying_internal_dissidents
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_internal_dissidents_1}
			NOT = {has_country_modifier = magic_estate_scrying_internal_dissidents_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_internal_dissidents_2}
			NOT = {has_country_modifier = magic_estate_scrying_internal_dissidents_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_internal_dissidents_3}
			NOT = {has_country_modifier = magic_estate_scrying_internal_dissidents_3}
		}
	}
	effect = {
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 40 }
			}
			add_mana_effect = { mana = -40 }
			add_country_modifier = { name = magic_estate_scrying_internal_dissidents_3 duration = 3650 }
		}
		else_if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 33 } 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
			}
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_internal_dissidents_2 duration = 3650 }
			custom_tooltip = magisters_need_40_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else_if = {
			limit = {
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 }
			}
			add_mana_effect = { mana = -20 }
			add_country_modifier = { name = magic_estate_scrying_internal_dissidents_1 duration = 3650 }
			custom_tooltip = magisters_need_30_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		else = {
			custom_tooltip = magisters_need_20_30_40_mana_tt
		}
		custom_tooltip = magic_scrying_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_divination
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Scrying Internal Dissidents"
}
custom_button = {
    name = magic_menu_aid_war_effort
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		is_at_war = yes
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 30 }
		if = {
			limit = {has_country_modifier = magic_estate_scrying_military_intelligence_1}
			NOT = {has_country_modifier = magic_estate_scrying_military_intelligence_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_military_intelligence_2}
			NOT = {has_country_modifier = magic_estate_scrying_military_intelligence_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_scrying_military_intelligence_3}
			NOT = {has_country_modifier = magic_estate_scrying_military_intelligence_3}
		}
	}
	effect = {
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 }
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 90 }
			}
			add_mana_effect = { mana = -90 }
			add_country_modifier = { name = magic_estate_scrying_military_intelligence_3 duration = 1825 }
			every_country = {
				limit = { war_with = ROOT }
				remove_fow = 4
			}
		}
		else_if = { 
			limit = { 
				OR = { estate_influence = { estate = estate_mages influence = 33 } has_country_flag = command_enslaved_the_oracle_flag } 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 60 }
			}
			add_mana_effect = { mana = -60 }
			add_country_modifier = { name = magic_estate_scrying_military_intelligence_2 duration = 1825 }
			every_country = {
				limit = { war_with = ROOT }
				remove_fow = 3
			}
			custom_tooltip = magisters_need_90_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else = { 
			add_mana_effect = { mana = -30 }
			add_country_modifier = { name = magic_estate_scrying_military_intelligence_1 duration = 1825 }
			every_country = {
				limit = { war_with = ROOT }
				remove_fow = 2
			}
			custom_tooltip = magisters_need_60_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		
		custom_tooltip = magic_scrying_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_enchantment
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Overwrite Fear"
}
custom_button = {
    name = magic_menu_foretelling
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_divination
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = divination_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = divination_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = divination_school_reform_modifier}
			NOT = {has_country_modifier = divination_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = divination_school_reform_modifier duration = 365 }
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = divination_school_reform_modifier duration = 365 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_divination
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Foretelling"
}
custom_button = {
    name = magic_menu_weaken_minds
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = enchantment_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = enchantment_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = enchantment_school_reform_modifier}
			NOT = {has_country_modifier = enchantment_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			hidden_effect = {
				add_country_modifier = { name = enchantment_school_reform_modifier_flag duration = 730 }
			}
			tooltip = {
				custom_tooltip = every_war_enemy_tt
				add_country_modifier = { name = enchantment_school_reform_modifier duration = 730 }
			}
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50}
				custom_tooltip = every_war_enemy_tt
				add_country_modifier = { name = enchantment_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_enchantment
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Weaken Minds"
}
custom_button = {
    name = magic_menu_healing_spells
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_transmutation
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = transmutation_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = transmutation_school_reform }
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = transmutation_school_reform_modifier}
			NOT = {has_country_modifier = transmutation_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = transmutation_school_reform_modifier duration = 730 }
			hidden_effect = {
				add_country_modifier = { name = transmutation_school_reform_marine_modifier duration = 730 hidden = yes }
				add_country_modifier = { name = transmutation_school_reform_undead_modifier duration = 730 hidden = yes }
			}
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = transmutation_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_transmutation
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Healing Spells"
}
custom_button = {
	name = gold_transmutation_spell
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_transmutation
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = transmutation_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = transmutation_school_reform }
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
	}
	effect = {
		add_years_of_income = 0.25
		add_inflation = 2
		FROM = { add_mana_effect = { mana = -50 } }
		if = {
			limit = { ai = no }
			clr_country_flag = estate_mages_cast_spells
			clr_country_flag = estate_mages_cast_spell_transmutation
		}
	}
	tooltip = "Gold Transmutation"
}
custom_button = {
    name = magic_menu_evocated_weapons
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_evocation
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = evocation_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = evocation_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = evocation_school_reform_modifier}
			NOT = {has_country_modifier = evocation_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = evocation_school_reform_modifier duration = 730 }
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = evocation_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_transmutation
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Evocated Weapons"
}
custom_button = {
    name = magic_menu_delusions
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_illusion
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = illusion_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = illusion_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = illusion_school_reform_modifier}
			NOT = {has_country_modifier = illusion_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			tooltip = {
				custom_tooltip = "Every owned province get:"
				add_province_modifier = { name = illusion_school_reform_modifier duration = 730 }
			}
			hidden_effect = {
				every_owned_province = { add_province_modifier = { name = illusion_school_reform_modifier duration = 730 } }
			}
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				custom_tooltip = "Every owned province get:"
				add_province_modifier = { name = illusion_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_illusion
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Delusions"
}
custom_button = {
    name = magic_menu_fake_comet_spell
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_illusion
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = illusion_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = illusion_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 }
		custom_trigger_tooltip = {
			tooltip = magic_menu_diplomatic_actions_spell_tt
			always = no
		}
	}
	effect = {
		tooltip = {
			if = {
				limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 } }
				add_mana_effect = { mana = -75 }
				custom_tooltip = "Target Country gets:"
				country_event = { id = 5060 days = 5 random = 20 }
			}
			else = {
				custom_tooltip = magisters_need_75_mana_tt
				tooltip = {
					custom_tooltip = "Target Country gets:"
					country_event = { id = 5060 days = 5 random = 20 }
				}
			}
		}
	}
	tooltip = "Comet Illusion"
}
custom_button = {
    name = magic_menu_elemental_summoning
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	trigger = {
		if = {
			limit = { has_estate_privilege = estate_mages_organization_magisterium }
			A85 = { has_unlocked_spell = { spell = conjuration_school_reform} }
		}
		else = {
			has_unlocked_spell = { spell = conjuration_school_reform}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = conjuration_school_reform_modifier}
			NOT = {has_country_modifier = conjuration_school_reform_modifier}
		}
	}
	effect = {
		if = {
			limit = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 } }
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = conjuration_school_reform_modifier duration = 730 }
		}
		else = {
			custom_tooltip = magisters_need_50_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				add_mana_effect = { mana = -50 }
				add_country_modifier = { name = conjuration_school_reform_modifier duration = 730 }
			}
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Elemental Summoning"
}
custom_button = {
    name = magic_menu_aid_constructions
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_conjuration
	}
	trigger = {
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
		if = {
			limit = {has_country_modifier = magic_estate_aiding_construction_1}
			NOT = {has_country_modifier = magic_estate_aiding_construction_1}
		}
		if = {
			limit = {has_country_modifier = magic_estate_aiding_construction_2}
			NOT = {has_country_modifier = magic_estate_aiding_construction_2}
		}
		if = {
			limit = {has_country_modifier = magic_estate_aiding_construction_3}
			NOT = {has_country_modifier = magic_estate_aiding_construction_3}
		}
	}
	effect = {
		if = { 
			limit = { 
				estate_influence = { estate = estate_mages influence = 66 } 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 90 }
			}
			add_mana_effect = { mana = -90 }
			add_country_modifier = { name = magic_estate_aiding_construction_3 duration = 3650 }
			hidden_effect = {
				remove_country_modifier = magic_estate_aiding_construction_1
				remove_country_modifier = magic_estate_aiding_construction_2
			}
		}
		else_if = {
			limit = { 
				NOT = {has_country_modifier = magic_estate_aiding_construction_3}
				estate_influence = { estate = estate_mages influence = 33 } 
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 70 }
			}
			add_mana_effect = { mana = -70 }
			add_country_modifier = { name = magic_estate_aiding_construction_2 duration = 3650 }
			hidden_effect = {
				remove_country_modifier = magic_estate_aiding_construction_1
			}
			custom_tooltip = magisters_need_90_mana_tt
			custom_tooltip = "to get lvl 3 Spell"
		}
		else_if = {
			limit = {
				NOT = {has_country_modifier = magic_estate_aiding_construction_3}
				NOT = {has_country_modifier = magic_estate_aiding_construction_2}
				has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 50 }
			}
			add_mana_effect = { mana = -50 }
			add_country_modifier = { name = magic_estate_aiding_construction_1 duration = 3650 }
			custom_tooltip = magisters_need_70_mana_tt
			custom_tooltip = "to get lvl 2 Spell"
		}
		else_if = {	#already have spell
			limit = {
				OR = {
					has_country_modifier = magic_estate_aiding_construction_1
					has_country_modifier = magic_estate_aiding_construction_2
					has_country_modifier = magic_estate_aiding_construction_3
				}
			}
			custom_tooltip = "Spell Already active"
		}
		else = {
			custom_tooltip = magisters_need_50_70_90_mana_tt
			tooltip = {
				custom_tooltip = "Would give:"
				if = { 
					limit = { estate_influence = { estate = estate_mages influence = 66 } }
					add_mana_effect = { mana = -90 }
					add_country_modifier = { name = magic_estate_aiding_construction_3  duration = 3650 }
				}
				else_if = {
					limit = { estate_influence = { estate = estate_mages influence = 33 } }
					add_mana_effect = { mana = -70 }
					add_country_modifier = { name = magic_estate_aiding_construction_2 duration = 3650 }
				}
				else = {
					add_mana_effect = { mana = -50 }
					add_country_modifier = { name = magic_estate_aiding_construction_1 duration = 3650 }
				}
			}
		}
		
		custom_tooltip = magic_construction_desc_tt
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_conjuration
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Aid Constructions"
}
custom_button = {
    name = magic_menu_rite_of_conception_spell
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		has_consort = yes
		has_government_attribute = heir
		is_lesser_in_union = no
		NOT = { ruler_is_immortal = yes } # No lich babies	
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 }
	}
	effect = {
		if = {
			limit = { has_heir = yes }
			add_legitimacy = -25
		}
		add_mana_effect = { mana = -75 }
		custom_tooltip = magic_estate_rite_of_conception_tooltip
		
		custom_tooltip = magic_conception_desc_tt
		hidden_effect = {
			country_event = { id = acolyte_estate.9 }
			if = {
				limit = { NOT = { has_country_flag = estate_mages_cast_spells } }
				remove_country_modifier = magic_cooldown
			}
			if = { # Causes crashes on Linux
				limit = { ai = no }
				clr_country_flag = estate_mages_cast_spells
				clr_country_flag = estate_mages_cast_spell_enchantment
			}
			else = {
				set_country_flag = revoke_mage_estate_spells
			}
		}
	}
	tooltip = "Rite of Conception"
}
custom_button = {
    name = magic_menu_mind_control_spell
    
    potential = {
		ai = no	
		has_country_flag = estate_mages_cast_spells
		has_country_flag = estate_mages_cast_spell_enchantment
	}
	trigger = {
		OR = {
			custom_trigger_tooltip = {
				tooltip = magic_menu_mind_control_spell_adm_tt
				employed_advisor = { category = ADM }
				NOT = { has_country_modifier = magic_menu_mind_control_spell_adm_modifier }
			}
			custom_trigger_tooltip = {
				tooltip = magic_menu_mind_control_spell_dip_tt
				employed_advisor = { category = DIP }
				NOT = { has_country_modifier = magic_menu_mind_control_spell_dip_modifier }
			}
			custom_trigger_tooltip = {
				tooltip = magic_menu_mind_control_spell_mil_tt
				employed_advisor = { category = MIL }
				NOT = { has_country_modifier = magic_menu_mind_control_spell_mil_modifier }
			}
		}
		has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 75 }
	}
	effect = {
		add_mana_effect = { mana = -75 }
		custom_tooltip = magic_menu_mind_control_spell_tooltip
		
		custom_tooltip = magic_mind_control_desc_tt
		hidden_effect = {
			random_list = {
				33 = {
					trigger = { employed_advisor = { category = ADM } NOT = { has_country_modifier = magic_menu_mind_control_spell_adm_modifier } }
					add_country_modifier = { name = magic_menu_mind_control_spell_adm_modifier duration = -1 }
				}
				33 = {
					trigger = { employed_advisor = { category = DIP } NOT = { has_country_modifier = magic_menu_mind_control_spell_dip_modifier } }
					add_country_modifier = { name = magic_menu_mind_control_spell_dip_modifier duration = -1 }
				}
				33 = {
					trigger = { employed_advisor = { category = MIL } NOT = { has_country_modifier = magic_menu_mind_control_spell_mil_modifier } }
					add_country_modifier = { name = magic_menu_mind_control_spell_mil_modifier duration = -1 }
				}
			}
		}
	}
	tooltip = "Control Mind"
}
custom_button = {
	name = fire_ball_spell
	potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { 
			if = {
				limit = { has_estate_privilege = estate_mages_organization_magisterium }
				A85 = { has_unlocked_spell = { spell = evocation_school_reform} }
			}
			else = {
				has_unlocked_spell = { spell = evocation_school_reform}
			}
		}
	}
	trigger = {
		FROM = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 20 } }
	}
	effect = {
		custom_tooltip = change_siege_progress_by_1_tt
		hidden_effect = { change_siege = 1 }
		FROM = { add_mana_effect = { mana = -20 } }
	}
	tooltip = "Fire Ball"
}
custom_button = {
	name = earthquake_spell
	potential = {
		fort_level = 1
		has_siege = yes
		sieged_by = FROM
		FROM = { 
			if = {
				limit = { has_estate_privilege = estate_mages_organization_magisterium }
				A85 = { has_unlocked_spell = { spell = evocation_school_reform} }
			}
			else = {
				has_unlocked_spell = { spell = evocation_school_reform}
			}
		}
	}
	trigger = {
		FROM = { has_government_power = { mechanic_type = magisterium_mechanic power_type = magisterium_mana value = 40 } }
	}
	effect = {
		custom_tooltip = change_siege_progress_by_3_tt
		hidden_effect = { change_siege = 3 }
		add_province_modifier = {name = siege_magic_earthquake duration = 365}
		add_base_tax = -2
		add_base_production = -2
		add_base_manpower = -2
		add_devastation = 10
		hidden_effect = {magic_siege_defence = yes}
		FROM = { add_mana_effect = { mana = -40 } }
	}
	tooltip = "Earthquake"
}